<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fallback SVG Test</title>
    <style>
        body {
            font-family: system-ui, -apple-system, Arial;
            background: #1a1a2e;
            color: white;
            padding: 40px;
        }
        .container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .test-card {
            text-align: center;
        }
        .test-card h3 {
            margin-bottom: 10px;
            font-size: 14px;
            color: #888;
        }
        .poster {
            width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        h1 {
            text-align: center;
            margin-bottom: 40px;
        }
    </style>
</head>
<body>
    <h1>ðŸŽ¬ Text-Based Fallback Tests</h1>
    <div class="container">
        <!-- Test 1: Short title -->
        <div class="test-card">
            <h3>Short Title</h3>
            <img class="poster" src="broken.jpg" onerror="this.src=createTestFallback('Mom', '2017', '03 Nov 2025', ['Amazon Prime Video', 'Platform 52'])">
        </div>

        <!-- Test 2: Long title -->
        <div class="test-card">
            <h3>Long Title</h3>
            <img class="poster" src="broken.jpg" onerror="this.src=createTestFallback('The Amazing Spider-Man: No Way Home Extended Edition', '2024', '15 Dec 2025', ['Netflix', 'Disney+'])">
        </div>

        <!-- Test 3: Very long title -->
        <div class="test-card">
            <h3>Very Long Title (3 lines)</h3>
            <img class="poster" src="broken.jpg" onerror="this.src=createTestFallback('Indiana Jones and the Dial of Destiny: Special Extended Directors Cut', '2023', '20 Jan 2026', ['Paramount+', 'Apple TV+'])">
        </div>

        <!-- Test 4: No year -->
        <div class="test-card">
            <h3>No Year Info</h3>
            <img class="poster" src="broken.jpg" onerror="this.src=createTestFallback('Mystery Movie', '', '25 Dec 2025', ['HBO Max', 'Hulu'])">
        </div>

        <!-- Test 5: Minimal info -->
        <div class="test-card">
            <h3>Minimal Info</h3>
            <img class="poster" src="broken.jpg" onerror="this.src=createTestFallback('Untitled', '', '', ['TBA'])">
        </div>

        <!-- Test 6: Many platforms -->
        <div class="test-card">
            <h3>Many Platforms</h3>
            <img class="poster" src="broken.jpg" onerror="this.src=createTestFallback('Avengers: Secret Wars', '2026', '05 May 2026', ['Disney+', 'Marvel', 'Hulu', 'Star'])">
        </div>
    </div>

    <script>
        function createTestFallback(title, year, releaseDate, platforms) {
            const platformsList = platforms.slice(0, 2).join(', ');

            // Split title into multiple lines if too long
            const words = title.split(' ');
            const lines = [];
            let currentLine = '';

            words.forEach(word => {
                const testLine = currentLine ? `${currentLine} ${word}` : word;
                if (testLine.length > 20 && currentLine) {
                    lines.push(currentLine);
                    currentLine = word;
                } else {
                    currentLine = testLine;
                }
            });
            if (currentLine) lines.push(currentLine);

            const titleLines = lines.slice(0, 3);

            // Calculate vertical positioning
            const baseY = 180;
            const titleY = baseY - (titleLines.length - 1) * 15;

            let svg = `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 450'>`;
            svg += `<defs><linearGradient id='grad-${Date.now()}' x1='0%' y1='0%' x2='100%' y2='100%'>`;
            svg += `<stop offset='0%' style='stop-color:#667eea;stop-opacity:1' />`;
            svg += `<stop offset='100%' style='stop-color:#764ba2;stop-opacity:1' />`;
            svg += `</linearGradient></defs>`;
            svg += `<rect fill='url(#grad-${Date.now()})' width='300' height='450'/>`;

            // Add movie icon
            svg += `<text x='50%' y='120' text-anchor='middle' font-size='48' fill='white' opacity='0.3'>ðŸŽ¬</text>`;

            // Add title lines
            titleLines.forEach((line, i) => {
                const y = titleY + (i * 30);
                svg += `<text x='50%' y='${y}' text-anchor='middle' font-family='system-ui, -apple-system, Arial' font-size='22' font-weight='bold' fill='white'>${encodeURIComponent(line)}</text>`;
            });

            // Add year if available
            if (year) {
                const yearY = titleY + (titleLines.length * 30) + 20;
                svg += `<text x='50%' y='${yearY}' text-anchor='middle' font-family='system-ui, -apple-system, Arial' font-size='16' fill='white' opacity='0.8'>${encodeURIComponent(year)}</text>`;
            }

            // Add release date
            if (releaseDate) {
                const dateY = titleY + (titleLines.length * 30) + (year ? 45 : 25);
                svg += `<text x='50%' y='${dateY}' text-anchor='middle' font-family='system-ui, -apple-system, Arial' font-size='14' fill='white' opacity='0.7'>${encodeURIComponent(releaseDate)}</text>`;
            }

            // Add platforms
            if (platformsList) {
                const platformY = titleY + (titleLines.length * 30) + (year ? 70 : 50) + (releaseDate ? 0 : -20);
                svg += `<text x='50%' y='${platformY}' text-anchor='middle' font-family='system-ui, -apple-system, Arial' font-size='12' fill='white' opacity='0.6'>${encodeURIComponent(platformsList)}</text>`;
            }

            svg += `</svg>`;

            return `data:image/svg+xml,${svg}`;
        }
    </script>
</body>
</html>
